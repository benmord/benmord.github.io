<HTML>
<HEAD>
<META name="viewport" content="width=device-width, user-scalable=no" />
<STYLE>
* {margin: 0; padding: 0; border: 0}
</STYLE>
</HEAD>

<BODY bgcolor="#F8F8F8">

<!--
<SVG style="background-color:#CCCCCC;" width="964" height="1804" version="1.1"
xmlns="http://www.w3.org/2000/svg" id="svgCanvas" >
</SVG>
-->


<SVG style="background-color:#CCCCCC;" width="100%" height="100%" version="1.1"
xmlns="http://www.w3.org/2000/svg" id="svgCanvas" >
</SVG>


<SCRIPT>


//	alert(document.documentElement.clientWidth);
//	alert(document.documentElement.clientHeight);

//	alert('window.screen.width is ' + window.screen.width.toString());
//	alert('window.screen.availWidth is ' + window.screen.availWidth.toString());
//	alert('window.screen.height is ' + window.screen.height.toString());
//	alert('window.screen.availHeight is ' + window.screen.availHeight.toString());

//	alert('window.innerWidth is ' + window.innerWidth.toString());
//	alert('window.innerHeight is ' + window.innerHeight.toString());


	document.getElementsByTagName('body')

	var svgNS = "http://www.w3.org/2000/svg";
	cont = document.createElementNS(svgNS, 'svg');
	cont.setAttributeNS(svgNS, 'style', "background-color:#CCCCCC;");
	cont.setAttributeNS(svgNS, "width", "1833");
	cont.setAttributeNS(svgNS, "height", "981");
	cont.setAttributeNS(svgNS, "version", "1.1");	
//	cont.setAttributeNS(null, "xmlns", "http://www.w3.org/2000/svg");	
	cont.setAttributeNS(svgNS, "id", "svgCanvas");	
//	document.body.appendChild(cont);
	var cont = document.getElementById("svgCanvas");
	cont.setAttributeNS(svgNS, "width", "5");
	
	
	
	function drawText(text, weight, fill, anchor, id, x, y, size, invoke="", rotate=false, cl='', makerect=true, rectcolor='#ccccaa', rectw=180, recth=110) {
		var nodeG = document.createElementNS(svgNS, 'g');
		nodeG.setAttributeNS(null, "onmousedown", invoke);
		nodeG.setAttributeNS(null, "class", cl);
		nodeG.setAttributeNS(null, "id", id);
		var nodeTxt = document.createElementNS(svgNS, 'text');
		nodeTxt.setAttributeNS(null, "font-weight", weight);
		nodeTxt.setAttributeNS(null, "fill", fill);
		nodeTxt.setAttributeNS(null, "font-size", size);	
		nodeTxt.setAttributeNS(null, "text-anchor", anchor);
		if (rotate) {
			nodeTxt.setAttributeNS(null, "writing-mode", "tb");
//			nodeTxt.setAttributeNS(null, "glyph-orientation-vertical", "0");
		}
//		nodeTxt.setAttributeNS(null, "id", id);
		nodeTxt.setAttributeNS(null, "class", cl);
//		nodeTxt.setAttributeNS(null, "onclick", invoke);		
		var txt = document.createTextNode(text);
		nodeTxt.appendChild(txt);
		nodeTxt.setAttributeNS(null, "x", x);
		nodeTxt.setAttributeNS(null, "y", y);			
		cont.appendChild(nodeG);
		if (makerect) {
			var nodeRect = document.createElementNS(svgNS, 'rect');
			nodeRect.setAttributeNS(null, "width", rectw);
			nodeRect.setAttributeNS(null, "height", recth);
			nodeRect.setAttributeNS(null, "x", x-(rectw/2));
			nodeRect.setAttributeNS(null, "y", y-0.8*recth);
			nodeRect.setAttributeNS(null, "style", "fill:"+ rectcolor +";opacity:1");
			nodeG.appendChild(nodeRect);
		}
		nodeG.appendChild(nodeTxt);		
	}
	
		
	function removeElement(id) {
//		alert('removing element ' + id)
		var e = document.getElementById(id);
		if (e != null) {
			e.parentNode.removeChild(e);
		}
	}
	
	
	function getWidth() {
		return cont.clientWidth;
		if (cont.width.animVal.unitType != 2) {
//			alert('WARNING - unit type is ' + cont.width.animVal.unitType)
		}
		return cont.width.animVal.value;
	}	
	
	function getHeight() {
		return cont.clientHeight;
		if (cont.height.animVal.unitType != 2) {
//			alert('WARNING - unit type is ' + cont.height.animVal.unitType)
		}
		return cont.height.animVal.value;
	}
	
//	animate('question');

	var cw = getWidth() / 5;
	var ch = getHeight() / 18;

	stack = [];
	entry = '';
	
	

	function removeClass(cl) {
		var oldItems = document.getElementsByClassName(cl);
		while (oldItems.length != 0) {
			for (var i=0; i<oldItems.length; i++) {
				oldItems[i].remove();	
			}
			oldItems = document.getElementsByClassName(cl);
		}
	}
		
	
	function disp(num) {
		if ((Math.abs(parseFloat(num)) / 10000 > 1 || Math.abs(parseFloat(num)) * 10000 < 1) && parseFloat(num) != 0) {
			return parseFloat(num).toExponential(8);
		} else if (num.toString().length > 14) {
			return num.toString().substring(0, 11) + '...';
		}				
		return num.toString();
	}	
	
	function toclip(data) {
		
	}

	function drawStack() {
		pt = 0.8*Math.min(cw, ch);
		removeClass('stackitem');
//		alert('starting drawStack for stack ' + stack.toString());
//		alert('stack.length-1 is ' + (stack.length-1).toString());
//		alert('stack.length>=(stack.length-7 && stack.length > -1 is ' + (stack.length-7>=(stack.length-7) && stack.length > -1));
//		alert('stack.length>=(stack.length-7 is ' + (stack.length>=(stack.length-7)));
//		alert('stack.length > -1 is ' + (stack.length > -1));
		for (var i=stack.length-1; i>=(stack.length-7) && i > -1; i--) {
//			alert('about to draw stack entry ' + i.toString() + ' of stack ' + stack.toString());
			h = i*ch + 0.6*getHeight() - (stack.length)*ch;
//			h = 0.6*getHeight() - i*ch
			var color = 'black';
			if (stack.length-i>7) {
				color='gray'
			}
			drawText(disp(stack[i]), 'bold', color, 'end', 'score', getWidth() - 0.5*cw, h, pt, 'toclip("' + stack[i].toString() + '")', false, 'stackitem', false);
		}
	
	}
	
	function drawEntry() {
		pt = 0.8*Math.min(cw, ch);
		var oldItems = document.getElementsByClassName('entry');
		for (var i=0; i<oldItems.length; i++) {
			oldItems[i].remove();
		}	
		drawText(entry, 'bold', 'black', 'start', 'score', 0.1*cw, 0.6*getHeight(), pt, '', false, 'entry', false);
	}
	
	var page=0;	
	
	
	function calculate() {
		shouldClearEntry = true;
		switch(entry) {
			case '⏎':
				break;
			case '+':
				stack.push((parseFloat(stack.pop()) + parseFloat(stack.pop())).toString());
				break;
			case '-':
				b = parseFloat(stack.pop());
				a = parseFloat(stack.pop());
				stack.push((a - b).toString());
				break;
			case '*':
				stack.push((parseFloat(stack.pop()) * parseFloat(stack.pop())).toString());
				break;
			case '/':
				b = parseFloat(stack.pop());
				a = parseFloat(stack.pop());
				stack.push((a / b).toString());
				break;
			case 'C':
				stack.pop();
				break;
			case 'SWAP':
				b = parseFloat(stack.pop());
				a = parseFloat(stack.pop());
				stack.push(b.toString());
				stack.push(a.toString());
				break;
			case 'LOG':
				a = parseFloat(stack.pop());
				stack.push(Math.log10(a).toString());
				break;
			case 'LN':
				a = parseFloat(stack.pop());
				stack.push(Math.log(a).toString());
				break;
			case 'EXP':
				b = parseFloat(stack.pop());
				a = parseFloat(stack.pop());
				stack.push(a ** b).toString();
				break;
			case 'PI':
				stack.push('3.1415926535');
				break;
			case '(-)':
				entry = '';
				runscript('0 E SWAP -');
				break;
			case 'HIST':
				entry = '';
				navigator.clipboard.writeText(cmdhistory.join(' '));
				break;
			case 'RUN':
				entry = '';
				navigator.clipboard.readText().then(clipText => runscript(clipText));
				break;
			case 'UNDO':
				entry = '';
				cmdhistory.pop();
				histc = Array.from(cmdhistory);
				cmdhistory=[];
				stack=[];
				runscript(histc.join(' '), true);
				shouldClearEntry=false;
				break;
			case 'SIN':
				a = parseFloat(stack.pop());
				stack.push(Math.sin(a).toString());
				break;
			case 'COS':
				a = parseFloat(stack.pop());
				stack.push(Math.cos(a).toString());
				break;
			case 'TAN':
				a = parseFloat(stack.pop());
				stack.push(Math.tan(a).toString());
				break;
			case 'ASIN':
				a = parseFloat(stack.pop());
				stack.push(Math.asin(a).toString());
				break;
			case 'ACOS':
				a = parseFloat(stack.pop());
				stack.push(Math.acos(a).toString());
				break;
			case 'ATAN':
				a = parseFloat(stack.pop());
				stack.push(Math.atan(a).toString());
				break;
			case 'PREV':
				page = (2 + page - 1) % 2;
				drawMenu(page);
				break;
			case 'NEXT':
				page = (page + 1) % 2;
				drawMenu(page);
				break;
		}
		if (shouldClearEntry) {
			entry='';
		}
		drawEntry();
		drawStack();
		drawHistory();
	}
	
	var cmdhistory=[];
	
	function input(cmd) {
		cmdhistory.push(cmd);
		act(cmd);
	}
	
	function act(cmd) {
//		alert(cmd);
		if ('0123456789.'.includes(cmd)) {
			entry += cmd
			drawEntry();
			drawHistory();
		} else {
			if (entry != '') {
				stack.push(entry);
				entry = ''
			} else if (cmd == '⏎' && stack.length>0) {
				a = stack.pop();
				stack.push(a);
				stack.push(a);
			}
			entry = cmd;
			calculate();
		}
	}
	
	function runscript(script, record=false) {
		cmds = script.split(' ');
		for (var i=0;i<cmds.length;i++) {
			if (record) {
				input(cmds[i]);
			} else {
				act(cmds[i]);
			}
		}
	}
	
	function drawEnter(cw, ch) {
		pt = 0.8*Math.min(cw, ch);
		padding = Math.min(0.1*cw, 0.1*ch);

//		drawText('ENTER', 'bold', 'green', 'start', 'score', 0.5*cw, getHeight() - 95 - ch, 60, 'input("⏎")', true, 'button', true, 'orange', 10, 10);	

		var x = 0.5*cw;
		var y = getHeight() - .66*ch;

		var nodeG = document.createElementNS(svgNS, 'g');
		nodeG.setAttributeNS(null, "onmousedown", 'input("⏎")');
		nodeG.setAttributeNS(null, "class", 'button');
		var nodeTxt = document.createElementNS(svgNS, 'text');
		nodeTxt.setAttributeNS(null, "font-weight", 'bold');
		nodeTxt.setAttributeNS(null, "fill", 'green');
		nodeTxt.setAttributeNS(null, "font-size", pt);	
		nodeTxt.setAttributeNS(null, "text-anchor", 'middle');
//		nodeTxt.setAttributeNS(null, "writing-mode", "tb");
		nodeTxt.setAttributeNS(null, "id", 'EnterButton');
		nodeTxt.setAttributeNS(null, "class", 'button');
//		nodeTxt.setAttributeNS(null, "onclick", invoke);		
		var txt = document.createTextNode('⏎');
		nodeTxt.appendChild(txt);
		nodeTxt.setAttributeNS(null, "x", x);
		nodeTxt.setAttributeNS(null, "y", y);			
		cont.appendChild(nodeG);
		if (true) {
			var nodeRect = document.createElementNS(svgNS, 'rect');
			nodeRect.setAttributeNS(null, "width", cw-padding);
			nodeRect.setAttributeNS(null, "height", 2*ch-padding);
			nodeRect.setAttributeNS(null, "x", x-(0.5*cw));
			nodeRect.setAttributeNS(null, "y", y-(1.3*ch));
			nodeRect.setAttributeNS(null, "style", "fill:#ccccaa;opacity:1");
			nodeG.appendChild(nodeRect);
		}
		nodeG.appendChild(nodeTxt);		
	}	


//	function drawText(text, weight, fill, anchor, id, x, y, size, invoke="", rotate=false, cl='', makerect=true, rectcolor='#ccccaa', rectw=180, recth=110) {


	function drawButton(label, color, xindex, yindex, pt, call) {
		x = (xindex + 0.5)*cw;
		y = getHeight() - 10 - yindex*ch;
		padding = Math.min(0.1*cw, 0.1*ch);
		drawText(label, 'bold', color, 'middle', 'button_' + xindex.toString() + '_' + yindex.toString(), x, y, pt, call, false, '', true, '#ccccaa', cw-padding, ch-padding);
	}


	function drawKeyboard() {
	
		pt = 0.8*Math.min(cw, ch);
	
//		drawText('ENT', 'bold', 'black', 'center', 30, getHeight() - 10, 70);	
		drawButton('0', 'black', 1, 0, pt, 'input("0")');
		drawButton('.', 'black', 2, 0, pt, 'input(".")');
		drawButton('(-)', 'black', 3, 0, pt, 'input("(-)")');
		drawButton('+', 'blue', 4, 0, pt, 'input("+")');

//		drawText('ENTER', 'bold', 'green', 'start', 0.5*cw, getHeight() - 95 - ch, 60, 'input("⏎")', true, 'button', true, 'orange', 10, 10);
		drawEnter(cw, ch);			
		drawButton('1', 'black', 1, 1, pt, 'input("1")');
		drawButton('2', 'black', 2, 1, pt, 'input("2")');
		drawButton('3', 'black', 3, 1, pt, 'input("3")');
		drawButton('-', 'blue', 4, 1, pt, 'input("-")');
		
		drawButton('C', 'blue', 0, 2, pt, 'input("C")');
		drawButton('4', 'black', 1, 2, pt, 'input("4")');
		drawButton('5', 'black', 2, 2, pt, 'input("5")');
		drawButton('6', 'black', 3, 2, pt, 'input("6")');
		drawButton('x', 'blue', 4, 2, pt, 'input("*")');
				
		drawButton('↶', 'blue', 0, 3, pt, 'act("UNDO")');
		drawButton('7', 'black', 1, 3, pt, 'input("7")');
		drawButton('8', 'black', 2, 3, pt, 'input("8")');
		drawButton('9', 'black', 3, 3, pt, 'input("9")');
		drawButton('/', 'blue', 4, 3, pt, 'input("/")');
				
		drawButton('SWAP', 'red', 0, 4, 0.65*pt, 'input("SWAP")');
		drawButton('LOG', 'red', 1, 4, 0.65*pt, 'input("LOG")');
		drawButton('LN', 'red', 2, 4, 0.65*pt, 'input("LN")');
		drawButton('EXP', 'red', 3, 4, 0.65*pt, 'input("EXP")');
		drawButton('Pi', 'red', 4, 4, 0.65*pt, 'input("PI")');
				
		drawButton('HIST', 'red', 0, 5, 0.65*pt, 'act("HIST")');
		drawButton('RUN', 'red', 1, 5, 0.65*pt, 'act("RUN")');
		drawButton('SIN', 'red', 2, 5, 0.65*pt, 'input("SIN")');
		drawButton('COS', 'red', 3, 5, 0.65*pt, 'input("COS")');
		drawButton('TAN', 'red', 4, 5, 0.65*pt, 'input("TAN")');
				

	}
	
	function eraseMenu() {
		for (xindex=0;xindex<5;xindex++) {
			for (yindex=4;yindex<6;yindex++) {
				removeElement("button_" + xindex.toString() + '_' + yindex.toString());
			}
		}
	}
	
	function drawMenu(pg) {
		pt = 0.65*0.8*Math.min(cw, ch);
	
		eraseMenu();
		switch(pg) {
			case 0:
				drawButton('SWAP', 'red', 0, 4, pt, 'input("SWAP")');
				drawButton('LOG', 'red', 1, 4, pt, 'input("LOG")');
				drawButton('LN', 'red', 2, 4, pt, 'input("LN")');
				drawButton('EXP', 'red', 3, 4, pt, 'input("EXP")');
				drawButton('Pi', 'red', 4, 4, pt, 'input("PI")');
						
				drawButton('←', 'purple', 0, 5, pt, 'act("PREV")');
				drawButton('SIN', 'red', 1, 5, pt, 'input("SIN")');
				drawButton('COS', 'red', 2, 5, pt, 'input("COS")');
				drawButton('TAN', 'red', 3, 5, pt, 'input("TAN")');
				drawButton('→', 'purple', 4, 5, pt, 'act("NEXT")');			
				break
			case 1:
				drawButton('SWAP', 'red', 0, 4, pt, 'input("SWAP")');
				drawButton('HIST', 'red', 1, 4, pt, 'act("HIST")')
				drawButton('RUN', 'red', 2, 4, pt, 'act("RUN")');
				drawButton('EXP', 'red', 3, 4, pt, 'input("EXP")');
				drawButton('Pi', 'red', 4, 4, pt, 'input("PI")');
						
				drawButton('←', 'purple', 0, 5, pt, 'act("PREV")');
				drawButton('ASIN', 'red', 1, 5, pt, 'act("ASIN")');
				drawButton('ACOS', 'red', 2, 5, pt, 'input("ACOS")');
				drawButton('ATAN', 'red', 3, 5, pt, 'input("ATAN")');
				drawButton('→', 'purple', 4, 5, pt, 'act("NEXT")');			
				break
		}
	}
	
	function drawHistory() {
		pt = 0.4*Math.min(cw, ch);	
//		alert('about to draw history: ' + cmdhistory.toString());
		removeElement('cmdhistory');
		x = getWidth() - 0.5*cw;
		y = ch;
		drawText(cmdhistory.join(' '), 'bold', 'brown', 'end', 'cmdhistory', x, y, pt, '', false, 'cmdhistory', false);	
//		alert('drew history: ' + cmdhistory.toString());
	}
	
	drawKeyboard();
	drawStack();
	drawEntry();
	drawHistory();

//	eraseMenu();
	drawMenu(0);

//alert('screen width is: ' + screen.width.toString());
//alert('cont clientWidth is ' + cont.clientWidth.toString())
//alert('cont clientHeight is ' + cont.clientHeight.toString())
//alert('getWidth is: ' + getWidth().toString());
//alert('screen height is: ' + screen.height.toString());
//alert('getHeight is: ' + getHeight().toString());

	function dostuff() {
		alert('was clicked!!');
		alert(getWidth());
		alert(getHeight());
		//964 x 1804.3636... Chrome on a Pixel 4a
	}


</SCRIPT>





</BODY>


</HTML>
