<HTML>
<HEAD>
<META name="viewport" content="width=980, user-scalable=no" />
</HEAD>

<BODY bgcolor="#F8F8F8">


<SVG style="background-color:#CCCCCC;" width="964" height="1804" version="1.1"
xmlns="http://www.w3.org/2000/svg" id="svgCanvas" >
</SVG>

<!--
<SVG style="background-color:#FFFF55;" width="100%" height="100%" version="1.1"
xmlns="http://www.w3.org/2000/svg" id="svgCanvas" >
</SVG>
-->

<!--
<FORM onsubmit="return onSubmit()">
	<INPUT TYPE="TEXT" ID="input" />
</FORM>
-->

<SCRIPT>
	//http://www.spelling-words-well.com/support-files/elementary-spelling-words-100.pdf
	var words = ['again', 'although', 'answer', 'any', 'are', 'become', 'been', 'both', 'bought', 'catch', 'climbed', 'color', 'come', 'could', 'country', 'do', 'does', 'door', 'earth', 'edge', 'eight', 'enough', 'example', 'eyes', 'father', 'few', 'find', 'four', 'friend', 'from', 'give', 'great', 'group', 'have', 'heard', 'island', 'kind', 'knew', 'know', 'learn', 'listen', 'live', 'many', 'measure', 'most', 'mother', 'move', 'night', 'off', 'often', 'old', 'on', 'once', 'one', 'only', 'other', 'people', 'picture', 'piece', 'quickly', 'right', 'said', 'science', 'should', 'sign', 'snow', 'some', 'straight', 'stretch', 'sure', 'talk', 'their', 'there', 'they', 'though', 'thought', 'through', 'to', 'today', 'two', 'usually', 'walk', 'want', 'was', 'watch', 'water', 'were', 'what', 'where', 'who', 'women', 'word', 'work', 'world', 'would', 'write', 'wrote', 'you', 'young', 'your', 'Sebastian', 'Zachary', 'Zachary', 'Zachary', 'Zachary']
	var svgNS = "http://www.w3.org/2000/svg";
	var cont = document.getElementById("svgCanvas");
        var speed = 0.05;

        answer='42';

        function getQuestion() {
                a=Math.floor(Math.random()*10);
                b=Math.floor(Math.random()*10);
                word = a.toString() + ' + ' + b.toString();
                return [word, (a+b).toString()];
        }

	function removeWord(word) {
		var e = document.getElementById('question' + 'CONTAINER');
		e.parentNode.removeChild(e);
		e = document.getElementById(word);
		e.parentNode.removeChild(e);
	}

        function clearAnswer() {
                document.getElementById("input").value = '';
        }


	function onSubmit() {
		try {
			text = document.getElementById("input").value;
			textLabel = document.getElementById('question' + "CONTAINER");
			if (text == answer)  {
				var score = document.getElementById('score');
				scr = parseInt(score.childNodes[0].nodeValue);
				scr = scr + text.length;
				removeElement('score');
				drawText(scr, 'bold', 'black', 'center', 'score', 150, 500);					
				removeWord('question');
				var question = getQuestion();
				drawWord(question[0]);
                                answer=question[1];
				animate('question');
				document.getElementById("input").value = '';
			} else {
                                return false;
                        }
		} catch (e) {
			alert(e);
		} finally {
			return false;
		}
	}
	
	
	function drawText(text, weight, fill, anchor, id, x, y, size, invoke="", rotate=false, cl='', makerect=true, rectcolor='#ccccaa', rectw=180, recth=110) {
		var nodeG = document.createElementNS(svgNS, 'g');
		nodeG.setAttributeNS(null, "onmousedown", invoke);
		nodeG.setAttributeNS(null, "class", cl);
		var nodeTxt = document.createElementNS(svgNS, 'text');
		nodeTxt.setAttributeNS(null, "font-weight", weight);
		nodeTxt.setAttributeNS(null, "fill", fill);
		nodeTxt.setAttributeNS(null, "font-size", size);	
		nodeTxt.setAttributeNS(null, "text-anchor", anchor);
		if (rotate) {
			nodeTxt.setAttributeNS(null, "writing-mode", "tb");
//			nodeTxt.setAttributeNS(null, "glyph-orientation-vertical", "0");
		}
		nodeTxt.setAttributeNS(null, "id", id);
		nodeTxt.setAttributeNS(null, "class", cl);
//		nodeTxt.setAttributeNS(null, "onclick", invoke);		
		var txt = document.createTextNode(text);
		nodeTxt.appendChild(txt);
		nodeTxt.setAttributeNS(null, "x", x);
		nodeTxt.setAttributeNS(null, "y", y);			
		cont.appendChild(nodeG);
		if (makerect) {
			var nodeRect = document.createElementNS(svgNS, 'rect');
			nodeRect.setAttributeNS(null, "width", rectw);
			nodeRect.setAttributeNS(null, "height", recth);
			nodeRect.setAttributeNS(null, "x", x-(rectw/2));
			nodeRect.setAttributeNS(null, "y", y-recth + 20);
			nodeRect.setAttributeNS(null, "style", "fill:"+ rectcolor +";opacity:1");
			nodeG.appendChild(nodeRect);
		}
		nodeG.appendChild(nodeTxt);		
	}
	
	
	function drawScore() {
		drawText('SCORE: ', 'bold', 'black', 'center', 'scorelabel', 50, 500);
		drawText('0', 'bold', 'black', 'center', 'score', 150, 500);
	}
	
	function removeElement(id) {
		var e = document.getElementById(id);
		e.parentNode.removeChild(e);
	}
	
	function drawWord(word) {
		var node = document.createElementNS(svgNS, "circle");
		node.setAttributeNS(null, "id", 'question' + "CONTAINER");
		node.setAttributeNS(null, "r", "80");
		node.setAttributeNS(null, "cx", 100);
		node.setAttributeNS(null, "cy", 50);
		cont.appendChild(node);				
		drawText(word, 'bold', 'white', 'center', 'question', 80, 50);
	}

//	question = getQuestion();
//	drawWord(question[0]);
  //      answer=question[1];
//	drawScore();
	
	var lastRun= new Date().getTime();

	function animate(word) {
		document.getElementById("input").focus();
		var container = document.getElementById(word + 'CONTAINER');
		if (container == null) return;
		var w = document.getElementById(word);
		if (w == null) return;
		var cy = parseFloat(container.getAttribute("cy"));
		if (cy < 500) {
			now = new Date().getTime();
			cy = cy + (now - lastRun) * speed;
			lastRun = now;
			container.setAttribute("cy", cy);
			w.setAttribute("y", cy);
			window.setTimeout("animate('" + word + "')", 10);
		} else {
			removeWord(word);
                        clearAnswer();
//			word = words[Math.floor(Math.random()*words.length)]
                        question = getQuestion();
			drawWord(question[0]);
                        answer=question[1];
			animate(word);
		}
	}
	
	function getWidth() {
		if (cont.width.animVal.unitType != 2) {
//			alert('WARNING - unit type is ' + cont.width.animVal.unitType)
		}
		return cont.width.animVal.value;
	}	
	
	function getHeight() {
		if (cont.height.animVal.unitType != 2) {
//			alert('WARNING - unit type is ' + cont.height.animVal.unitType)
		}
		return cont.height.animVal.value;
	}
	
//	animate('question');

	var cw = 192;
	var ch = 120;

	stack = [];
	entry = '';
	
	

	function removeClass(cl) {
		var oldItems = document.getElementsByClassName(cl);
		while (oldItems.length != 0) {
			for (var i=0; i<oldItems.length; i++) {
				oldItems[i].remove();	
			}
			oldItems = document.getElementsByClassName(cl);
		}
	}
	
	function disp(num) {
		ret = num.toString();
		if (ret.length > 14) {
			if (parseFloat(num) / 10000 > 1 || parseFloat(num) * 10000 < 1) {
				ret = parseFloat(num).toExponential(8);
			} else {
				ret = ret.substring(0, 11) + '...';
			}				
		}
		return ret;
	}	
	
	function toclip(data) {
		
	}

	function drawStack() {
		removeClass('stackitem');
		for (var i=0; i<stack.length; i++) {
			h = i*ch + 0.6*getHeight() - (stack.length)*ch;
//			h = 0.6*getHeight() - i*ch
			drawText(disp(stack[i]), 'bold', 'black', 'end', 'score', getWidth() - 0.5*cw, h, 90, 'toclip("' + stack[i].toString() + '")', false, 'stackitem', false);
		}
	
	}
	
	function drawEntry() {
		var oldItems = document.getElementsByClassName('entry');
		for (var i=0; i<oldItems.length; i++) {
			oldItems[i].remove();
		}	
		drawText(entry, 'bold', 'black', 'start', 'score', 0.1*cw, 0.6*getHeight(), 90, '', false, 'entry', false);
	}
	
	function calculate() {
		switch(entry) {
			case 'ENTER':
				break;
			case '+':
				stack.push((parseFloat(stack.pop()) + parseFloat(stack.pop())).toString());
				break;
			case '-':
				b = parseFloat(stack.pop());
				a = parseFloat(stack.pop());
				stack.push((a - b).toString());
				break;
			case '*':
				stack.push((parseFloat(stack.pop()) * parseFloat(stack.pop())).toString());
				break;
			case '/':
				b = parseFloat(stack.pop());
				a = parseFloat(stack.pop());
				stack.push((a / b).toString());
				break;
			case 'C':
				stack.pop();
				break;
			case 'SWAP':
				b = parseFloat(stack.pop());
				a = parseFloat(stack.pop());
				stack.push(b.toString());
				stack.push(a.toString());
				break;
			case 'LOG':
				a = parseFloat(stack.pop());
				stack.push(Math.log10(a).toString());
				break;
			case 'LN':
				a = parseFloat(stack.pop());
				stack.push(Math.log(a).toString());
				break;
			case 'EXP':
				b = parseFloat(stack.pop());
				a = parseFloat(stack.pop());
				stack.push(a ** b).toString();
				break;
			case 'PI':
				stack.push('3.1415926535');
				break;
			case '(-)':
				entry = '';
				runscript('0 ENTER SWAP -');
				break;
			case 'HIST':
				entry = '';
				navigator.clipboard.writeText(cmdhistory.join(' '));
				break;
			case 'RUN':
				entry = '';
				navigator.clipboard.readText().then(clipText => runscript(clipText));
				break;
			case 'UNDO':
				entry = '';
				cmdhistory.pop();
				histc = Array.from(cmdhistory);
				cmdhistory=[];
				stack=[];
				runscript(histc.join(' '), true);
				break;
			case 'SIN':
				a = parseFloat(stack.pop());
				stack.push(Math.sin(a).toString());
				break;
			case 'COS':
				a = parseFloat(stack.pop());
				stack.push(Math.cos(a).toString());
				break;
			case 'TAN':
				a = parseFloat(stack.pop());
				stack.push(Math.tan(a).toString());
				break;
		}
		entry='';
		drawEntry();
		drawStack();
	}
	
	var cmdhistory=[];
	
	function input(cmd) {
		cmdhistory.push(cmd);
		act(cmd);
	}
	
	function act(cmd) {
//		alert(cmd);
		if ('0123456789.'.includes(cmd)) {
			entry += cmd
			drawEntry();
		} else {
			if (entry != '') {
				stack.push(entry);
				entry = ''
			} else if (cmd == 'ENTER' && stack.length>0) {
				a = stack.pop();
				stack.push(a);
				stack.push(a);
			}
			entry = cmd;
			calculate();
		}
	}
	
	function runscript(script, record=false) {
		cmds = script.split(' ');
		for (var i=0;i<cmds.length;i++) {
			if (record) {
				input(cmds[i]);
			} else {
				act(cmds[i]);
			}
		}
	}
	
	function drawButton(label, color, id, x, y, pt, call) {
		drawText(label, 'bold', color, 'middle', id, x, y, pt, call);
	}

	function drawEnter(cw, ch) {
//		drawText('ENTER', 'bold', 'green', 'start', 'score', 0.5*cw, getHeight() - 95 - ch, 60, 'input("ENTER")', true, 'button', true, 'orange', 10, 10);	

		var x = 0.5*cw;
		var y = getHeight() - 95 - ch;

		var nodeG = document.createElementNS(svgNS, 'g');
		nodeG.setAttributeNS(null, "onmousedown", 'input("ENTER")');
		nodeG.setAttributeNS(null, "class", 'button');
		var nodeTxt = document.createElementNS(svgNS, 'text');
		nodeTxt.setAttributeNS(null, "font-weight", 'bold');
		nodeTxt.setAttributeNS(null, "fill", 'green');
		nodeTxt.setAttributeNS(null, "font-size", '60');	
		nodeTxt.setAttributeNS(null, "text-anchor", 'start');
		nodeTxt.setAttributeNS(null, "writing-mode", "tb");
		nodeTxt.setAttributeNS(null, "id", 'EnterButton');
		nodeTxt.setAttributeNS(null, "class", 'button');
//		nodeTxt.setAttributeNS(null, "onclick", invoke);		
		var txt = document.createTextNode('ENTER');
		nodeTxt.appendChild(txt);
		nodeTxt.setAttributeNS(null, "x", x);
		nodeTxt.setAttributeNS(null, "y", y);			
		cont.appendChild(nodeG);
		if (true) {
			var nodeRect = document.createElementNS(svgNS, 'rect');
			nodeRect.setAttributeNS(null, "width", 180);
			nodeRect.setAttributeNS(null, "height", 230);
			nodeRect.setAttributeNS(null, "x", x-90);
			nodeRect.setAttributeNS(null, "y", y-10);
			nodeRect.setAttributeNS(null, "style", "fill:#ccccaa;opacity:1");
			nodeG.appendChild(nodeRect);
		}
		nodeG.appendChild(nodeTxt);		



	}


	function drawKeyboard() {
	
//		drawText('ENT', 'bold', 'black', 'center', 'score', 30, getHeight() - 10, 70);	
		drawButton('0', 'black', 'score', 1.5*cw, getHeight() - 10, 100, 'input("0")');
		drawButton('.', 'black', 'score', 2.5*cw, getHeight() - 10, 100, 'input(".")');
		drawButton('(-)', 'black', 'score', 3.5*cw, getHeight() - 10, 100, 'input("(-)")');
		drawButton('+', 'blue', 'score', 4.5*cw, getHeight() - 10, 100, 'input("+")');

//		drawText('ENTER', 'bold', 'green', 'start', 'score', 0.5*cw, getHeight() - 95 - ch, 60, 'input("ENTER")', true, 'button', true, 'orange', 10, 10);
		drawEnter(cw, ch);			
		drawButton('1', 'black', 'score', 1.5*cw, getHeight() - 10 - ch, 100, 'input("1")');
		drawButton('2', 'black', 'score', 2.5*cw, getHeight() - 10 - ch, 100, 'input("2")');
		drawButton('3', 'black', 'score', 3.5*cw, getHeight() - 10 - ch, 100, 'input("3")');
		drawButton('-', 'blue', 'score', 4.5*cw, getHeight() - 10 - ch, 100, 'input("-")');
		
		drawButton('C', 'blue', 'score', 0.5*cw, getHeight() - 10 - 2*ch, 100, 'input("C")');
		drawButton('4', 'black', 'score', 1.5*cw, getHeight() - 10 - 2*ch, 100, 'input("4")');
		drawButton('5', 'black', 'score', 2.5*cw, getHeight() - 10 - 2*ch, 100, 'input("5")');
		drawButton('6', 'black', 'score', 3.5*cw, getHeight() - 10 - 2*ch, 100, 'input("6")');
		drawButton('x', 'blue', 'score', 4.5*cw, getHeight() - 10 - 2*ch, 100, 'input("*")');
				
		drawButton('U', 'blue', 'score', 0.5*cw, getHeight() - 10 - 3*ch, 100, 'act("UNDO")');
		drawButton('7', 'black', 'score', 1.5*cw, getHeight() - 10 - 3*ch, 100, 'input("7")');
		drawButton('8', 'black', 'score', 2.5*cw, getHeight() - 10 - 3*ch, 100, 'input("8")');
		drawButton('9', 'black', 'score', 3.5*cw, getHeight() - 10 - 3*ch, 100, 'input("9")');
		drawButton('/', 'blue', 'score', 4.5*cw, getHeight() - 10 - 3*ch, 100, 'input("/")');
				
		drawButton('SWAP', 'red', 'score', 0.5*cw, getHeight() - 10 - 4*ch, 70, 'input("SWAP")');
		drawButton('LOG', 'red', 'score', 1.5*cw, getHeight() - 10 - 4*ch, 70, 'input("LOG")');
		drawButton('LN', 'red', 'score', 2.5*cw, getHeight() - 10 - 4*ch, 70, 'input("POW")');
		drawButton('EXP', 'red', 'score', 3.5*cw, getHeight() - 10 - 4*ch, 70, 'input("EXP")');
		drawButton('Pi', 'red', 'score', 4.5*cw, getHeight() - 10 - 4*ch, 70, 'input("PI")');
				
		drawButton('HIST', 'red', 'score', 0.5*cw, getHeight() - 10 - 5*ch, 70, 'act("HIST")');
		drawButton('RUN', 'red', 'score', 1.5*cw, getHeight() - 10 - 5*ch, 70, 'act("RUN")');
		drawButton('SIN', 'red', 'score', 2.5*cw, getHeight() - 10 - 5*ch, 70, 'input("SIN")');
		drawButton('COS', 'red', 'score', 3.5*cw, getHeight() - 10 - 5*ch, 70, 'input("COS")');
		drawButton('TAN', 'red', 'score', 4.5*cw, getHeight() - 10 - 5*ch, 70, 'input("TAN")');
				

	}
	
	drawKeyboard();
	drawStack();
	drawEntry();

	function dostuff() {
		alert('was clicked!!');
		alert(getWidth());
		alert(getHeight());
		//964 x 1804.3636... Chrome on a Pixel 4a
	}


</SCRIPT>





</BODY>


</HTML>
